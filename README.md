# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è –£—Ä–§–£ MLops: xFlow

–í—Å–µ —Å–¥–µ–ª–∞–ª –≤ `docker`. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–±—Ä–∞–Ω—ã —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º `CUDA`, –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://learn.microsoft.com/ru-ru/windows/ai/directml/gpu-cuda-in-wsl).

> –ü–æ —É–º—É, —Ç—É—Ç –∫–æ–Ω–µ—á–Ω–æ, –ø—Ä–æ–º–∞–ø–∏—Ç—å –±–∞–∑—ã –∏ –ø–∞–ø–∫–∏ –∏–∑ –¥–æ–∫–µ—Ä–æ–≤, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è üòê. –¢–∞–∫ –∂–µ –¥–æ–∫–µ—Ä—ã –∫—Ä—É—Ç—è—Ç—Å—è —Å –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–æ–Ω—Å–æ–ª—å—é, —á—Ç–æ —Ç–æ–∂–µ –Ω–µ –æ—á–µ–Ω—å DevOps üòê.

**–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ –¥–æ–∫–µ—Ä–µ –Ω–µ —Å—Ç–∞–ª, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–ª–æ–µ–≤ –∏–∑–æ–ª—è—Ü–∏–∏ üòä**.

## AirFlow

> –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∞–ª–∏–∑–∞—Ü–∏–∏) **~14 Gb**

–ë–∏–ª–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
cd ...\xFlow\Airflow\
docker build --tag service/airflow ./
```

`tag` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ª—é–±–æ–π, –∫–∞–∫–æ–π –Ω—Ä–∞–≤–∏—Ç—Å—è.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–∞–π–ª–µ `\xFlow\Airflow\start.bat` –ø–æ–º–µ–Ω—è—Ç—å –ø–∞–ø–∫—É –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –≤ –º–æ–µ–º —Å–ª—É—á–∞–µ: `e:\ML-OPS\xFlow\scripts`:

```bash
docker run --gpus all -it --rm -p 8080:8080 -d -v e:\ML-OPS\xFlow\scripts:/scripts service/airflow 
```

–ü–æ—Ä—Ç—ã, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å.
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (`.\start.bat`) –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ `Docker Desctop`) –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Airflow:

```
/init_airflow.sh
```

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Airflow:

* username `Admin`
* firstname `admin`
* lastname `test`
* email `root@root.local`

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Airflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Å–æ–ª–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–¥–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä `127.0.0.1:8080`, –µ—Å–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –ø–æ—Ç–æ–º –ø–æ–∫–∞–∂–µ—Ç –¥–∞—à–±–æ—Ä–¥ - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

## MLFlow

**–¢—É—Ç –ø–æ–ø—Ä–æ—â–µ, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω**. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–∞–π–ª–µ `\xFlow\MLFlow\start.bat` –ø–æ–º–µ–Ω—è—Ç—å –ø–∞–ø–∫—É –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –≤ –º–æ–µ–º —Å–ª—É—á–∞–µ: `e:\ML-OPS\xFlow\artefacts`:

```bash
docker run --gpus all -it --rm -p 8080:8080 -d -v e:\ML-OPS\xFlow\scripts:/scripts service/airflow 
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Tracking URI (–µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤—Å–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö):

```bash
docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' mlflow
```

–ú–∞–ø–ø–∏–Ω–≥ –ø–∞–ø–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ mlflow. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
mlflow server --default-artifact-root file:/artefacts -h 0.0.0.0 -p 5000
```

## –ó–∞–¥–∞—á–∞

> –¢–∞–∫ –∫–∞–∫ —Ü–µ–ª—å –ø—Ä–∞–∫—Ç–∏–∫–∏ MLops –∑–∞–¥–∞—á–∞ –æ—á–µ–Ω—å –¥–∞–ª–µ–∫–∞ –æ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏. –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à–æ, —Ç–æ –≤ —Å—Ä–æ–∫ —Ç–æ—á–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–¥–∞—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å–ª–∏ –±—É–¥–µ—Ç –≤—Ä–µ–º—è, –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ–∫—Ä—É—Ç–∏—Ç—å –∏ –¥–æ —É–º–∞ –¥–æ–≤–µ—Å—Ç–∏. –ú–æ–∂–µ—Ç –¥–∞–∂–µ –æ–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∏–∫ —Å–¥–µ–ª–∞—Ç—å

* > –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: [hh](https://hh.ru)
* > –î–æ–º–µ–Ω—ã ML: nlp, classic ML
* > –ó–∞—á–µ–º –ø–∞–π–ø–ª–∞–π–Ω: —Ä—ã–Ω–æ–∫ –º–µ–Ω—è–µ—Ç—Å—è, –æ—Ü–µ–Ω–∫–∏ –ø–æ–ª–∑—É—Ç. –ï—Å–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –±—É–¥—É—Ç –¥–∞–Ω–Ω—ã–µ –æ –¥–∏–Ω–∞–º–∏–∫–µ —Ä—ã–Ω–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π.

–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏:

**–ü–æ —Ç–µ–∫—Å—Ç—É `responsibility` –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É (–∫–æ–≥–æ—Ä—Ç—É) [1] –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–µ (–∫–æ–≥–æ—Ä—Ç–∞, —á–µ–º –º–µ–Ω—å—à–µ –≤—Ä–µ–º—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ —Ç–µ–º –≤—ã—à–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è) [2]**

–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

* –¥–≤–∞ –Ω–∞–±–æ—Ä–∞ –ª–µ–π–±–ª–æ–≤ - –∑–ø –∏ –≤—Ä–µ–º—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (—Å—á–∏—Ç–∞–µ–º, –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
* —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è
* –º–æ–¥–µ–ª—å–∫–∞ - –≤–æ—Ç —Ç—É—Ç –ø—Ä—è–º –ª–µ–Ω–∏–≤–æ –∫—Ä—É—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã - –ø—Ä–æ—Å—Ç–æ —Å–∫–æ—Ä–º–∏–º XGBoost üòë

–í `reseach\reseach.ipynb` —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –∫—Ä–∞—Ç–∫–∏–π —Ä–µ—Å–µ—á –ø–µ—Ä–µ–¥ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –ø–∞–π–ø–ª–∞–π–Ω–∞.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. Airflow
   1. –æ–±–Ω–æ–≤–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã - –∏–∑–º–µ–Ω–∏–ª—Å—è –≤—ã–∑–æ–≤ BashOperator: `from airflow.operators.bash import BashOperator`
   2. `db init` is deprecated. Use `db migrate`
