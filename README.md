# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è –£—Ä–§–£ MLops: xFlow

–í—Å–µ —Å–¥–µ–ª–∞–ª –≤ `docker`. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–±—Ä–∞–Ω—ã —Å –ø—Ä–æ–±—Ä–æ—Å–æ–º `CUDA`, –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://learn.microsoft.com/ru-ru/windows/ai/directml/gpu-cuda-in-wsl).

> –ì–ª–∞–≤–Ω—ã–µ –ø–∞–ø–∫–∏ airflow –∏ mlflow –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã (–ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞). –¢–∞–∫ –∂–µ –¥–æ–∫–µ—Ä—ã –∫—Ä—É—Ç—è—Ç—Å—è —Å –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–æ–Ω—Å–æ–ª—å—é, —á—Ç–æ —Ç–æ–∂–µ –Ω–µ –æ—á–µ–Ω—å DevOps üòê.

**–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ –¥–æ–∫–µ—Ä–µ –Ω–µ —Å—Ç–∞–ª, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–ª–æ–µ–≤ –∏–∑–æ–ª—è—Ü–∏–∏ üòä**.

## AirFlow

> –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∞–ª–∏–∑–∞—Ü–∏–∏) **~14 Gb**. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–∞–º –ø–µ—Ä–µ—Å–æ–±—Ä–∞–ª, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–ª–∏–∑ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–∞–∫—à–Ω –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (redis, postgres –∏ –ø—Ä–æ—á–∏–µ —Ä–∞–¥–æ—Å—Ç–∏), –ø–ª—é—Å –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –∞ –∫–∞–∫ –Ω–∞–º –≤ ML –±–µ–∑ GPUüòÅ.

–ë–∏–ª–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
cd ...\xFlow\Airflow\
docker build --tag service/airflow ./
```

`tag` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ª—é–±–æ–π, –∫–∞–∫–æ–π –Ω—Ä–∞–≤–∏—Ç—Å—è.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–∞–π–ª–µ `\xFlow\Airflow\start.bat` –ø–æ–º–µ–Ω—è—Ç—å –ø–∞–ø–∫—É –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, (–≤ –º–æ–µ–º —Å–ª—É—á–∞: `e:\ML-OPS\xFlow\scripts`),
–∞ —Ç–∞–∫–∂–µ –ø–∞–ø–∫—É airflow (–≤ –º–æ–µ–º —Å–ª—É—á–∞–µ `e:\ML-OPS\xFlow\main_folders\Airflow`):

```bash
docker run --gpus all -it --rm -p 8080:8080 -d -v e:\ML-OPS\xFlow\scripts:/scripts -v e:\ML-OPS\xFlow\main_folders\Airflow:/root/airflow service/airflow
```

**!!–ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú –°–û–ó–î–ê–¢–¨ –ü–ê–ü–ö–ò, –ö–û–¢–û–†–´–ï –ú–û–ù–¢–ò–†–£–Æ–¢–°–Ø!!**

–ü–æ—Ä—Ç—ã, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å.
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (`.\start.bat`) –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ `Docker Desctop`) –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Airflow:

```bash
/init_airflow.sh
```

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Airflow:

* username `Admin`
* firstname `admin`
* lastname `test`
* email `root@root.local`

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Airflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Å–æ–ª–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–¥–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä `127.0.0.1:8080`, –µ—Å–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –ø–æ—Ç–æ–º –ø–æ–∫–∞–∂–µ—Ç –¥–∞—à–±–æ—Ä–¥ - –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `DAG` - –∫–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç—ã –≤ –ø—Ä–∏–º–æ—Ç–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É (–≤ –º–æ–µ–º —Å–ª—É—á–∞–µ `e:\ML-OPS\xFlow\main_folders\Airflow\dags`) –∏ –∂–¥–µ–º, –ø–æ–∫–∞ airflow –∏—Ö –ø–æ–¥—Ü–µ–ø–∏—Ç. –í—ã–∑—ã–≤–∞–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–º–µ—â–∞–µ–º –≤ scripts (–≤ –º–æ–µ–º —Å–ª—É—á–∞–µ `e:\ML-OPS\xFlow\scripts`), –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è scripts - `/scripts` (–∏–∑ –∫–æ—Ä–Ω—è).

## MLFlow

–°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
cd \xFlow\MLFlow
docker build --tag service/mlflow ./ 
```

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `\xFlow\MLFlow\start.bat`. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - –∑–∞–º–µ–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–∞–ø–∫–∏ —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏, –ø–∞–ø–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –º–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤

```bash
docker run -it --rm -p 5000:5000 --name mlflow -d -v e:\ML-OPS\xFlow\artefacts:/artifacts -v e:\ML-OPS\xFlow\scripts\mlflow:/scripts service/mlflow
```

**!!–ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú –°–û–ó–î–ê–¢–¨ –ü–ê–ü–ö–ò, –ö–û–¢–û–†–´–ï –ú–û–ù–¢–ò–†–£–Æ–¢–°–Ø!!**

–ü–æ—Ä—Ç—ã, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å.
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (`.\start.bat`) –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ `Docker Desctop`) –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å MLFlow:

```bash
/init_mlflowsh
```

–ë—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–µ—Ä (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å: http:/127.0.0.1:5000, –ø–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `5000`)

## –ó–∞–¥–∞—á–∞

> –¢–∞–∫ –∫–∞–∫ —Ü–µ–ª—å –ø—Ä–∞–∫—Ç–∏–∫–∏ MLops - –∑–∞–¥–∞—á–∞ –æ—á–µ–Ω—å –¥–∞–ª–µ–∫–∞ –æ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏. –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å —Ö–æ—Ä–æ—à–æ, —Ç–æ –≤ —Å—Ä–æ–∫ —Ç–æ—á–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–¥–∞—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ, –µ—Å–ª–∏ –±—É–¥–µ—Ç –≤—Ä–µ–º—è, –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ–∫—Ä—É—Ç–∏—Ç—å –∏ –¥–æ —É–º–∞ –¥–æ–≤–µ—Å—Ç–∏. –ú–æ–∂–µ—Ç –¥–∞–∂–µ –æ–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∏–∫ —Å–¥–µ–ª–∞—Ç—å

* > –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: [hh](https://hh.ru)
* > –î–æ–º–µ–Ω—ã ML: nlp, classic ML
* > –ó–∞—á–µ–º –ø–∞–π–ø–ª–∞–π–Ω: —Ä—ã–Ω–æ–∫ –º–µ–Ω—è–µ—Ç—Å—è, –æ—Ü–µ–Ω–∫–∏ –ø–æ–ª–∑—É—Ç. –ï—Å–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –±—É–¥—É—Ç –¥–∞–Ω–Ω—ã–µ –æ –¥–∏–Ω–∞–º–∏–∫–µ —Ä—ã–Ω–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π.

–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏:

**–ü–æ —Ç–µ–∫—Å—Ç—É `responsibility` –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É (–∫–æ–≥–æ—Ä—Ç—É) [1] –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–µ (–∫–æ–≥–æ—Ä—Ç–∞, —á–µ–º –º–µ–Ω—å—à–µ –≤—Ä–µ–º—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ —Ç–µ–º –≤—ã—à–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è) [2]**

–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

* –¥–≤–∞ –Ω–∞–±–æ—Ä–∞ –ª–µ–π–±–ª–æ–≤ - –∑–ø –∏ –≤—Ä–µ–º—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (—Å—á–∏—Ç–∞–µ–º, –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
* —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è
* –º–æ–¥–µ–ª—å–∫–∞ - –≤–æ—Ç —Ç—É—Ç –ø—Ä—è–º –ª–µ–Ω–∏–≤–æ –∫—Ä—É—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã - –ø—Ä–æ—Å—Ç–æ —Å–∫–æ—Ä–º–∏–º XGBoost üòë

–í `reseach\reseach.ipynb` —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –∫—Ä–∞—Ç–∫–∏–π —Ä–µ—Å–µ—á –ø–µ—Ä–µ–¥ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –ø–∞–π–ø–ª–∞–π–Ω–∞.

>Airflow - 1 –∑–∞–¥–∞—á–∞, MLflow - 2—è

–†–µ–∑—É–ª—å—Ç–∞—Ç Airflow:

![–†–µ–∑—É–ª—å—Ç–∞—Ç Airflow](assets/airflow_done.png)

**MLFlow**

–Ø —Ä–∞–∑–Ω–µ—Å airflow –∏ mlflow —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–∂–æ—Ä–ª–∏–≤—ã–µ.

–î–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ –¥–æ–∫–µ—Ä–µ:

```bash
cd /scripts
./run_experiment.sh
```

–†–µ–∑—É–ª—å—Ç–∞—Ç MLFlow:

![–†–µ–∑—É–ª—å—Ç–∞—Ç MLFlow](assets/mlflow_done.png)
